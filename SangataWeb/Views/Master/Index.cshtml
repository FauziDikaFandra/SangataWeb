@model SangataWeb.Models.ViewModel
@{
    ViewBag.Title = "Master SFU Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Master SFU Page";
    ViewBag.UserName = @Model.User_Login.UserName;
    ViewBag.Content = "Support";
}
@section pMain {
    <nav class="layout-navbar container-xxl navbar-detached navbar navbar-expand-xl align-items-center bg-navbar-theme"
         id="layout-navbar">
        <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                <i class="icon-base bx bx-menu icon-md"></i>
            </a>
        </div>

        <div class="navbar-nav-right d-flex align-items-center justify-content-end" id="navbar-collapse">
            <!-- Search -->
            <div class="navbar-nav align-items-center me-auto">
                <div class="nav-item d-flex align-items-center">
                   @*  <span class="w-px-22 h-px-22"><i class="icon-base bx bx-search icon-md"></i></span>
                    <input type="text"
                           class="form-control border-0 shadow-none ps-1 ps-sm-2 d-md-block d-none"
                           placeholder="Search..."
                           aria-label="Search..." /> *@
                </div>

            </div>
            <!-- /Search -->

            <ul class="navbar-nav flex-row align-items-center ms-md-auto">

                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                    <a class="nav-link dropdown-toggle hide-arrow p-0"
                       href="javascript:void(0);"
                       data-bs-toggle="dropdown">
                        <div class="avatar avatar-online">
                            <img src="../../../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                        </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a class="dropdown-item" href="#">
                                <div class="d-flex">
                                    <div class="flex-shrink-0 me-3">
                                        <div class="avatar avatar-online">
                                            <img src="../../../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-0">@Model.User_Login.UserName</h6>
                                        <small class="text-body-secondary">Admin</small>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <div class="dropdown-divider my-1"></div>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">
                                <i class="icon-base bx bx-user icon-md me-3"></i><span>My Profile</span>
                            </a>
                        </li>

                        <li>
                            <div class="dropdown-divider my-1"></div>
                        </li>
                        <li>
                            <a class="dropdown-item" href="../Home/Logout">
                                <i class="icon-base bx bx-power-off icon-md me-3"></i><span>Log Out</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <!--/ User -->
            </ul>
        </div>
    </nav>

    <!-- / Navbar -->
    <!-- Content wrapper -->
    <div class="content-wrapper">
        <!-- Content -->
        <div class="container-xxl flex-grow-1 container-p-y">
            <div class="row">
                <!-- Foreman -->
                <div class="col-md-6 col-lg-4 col-xl-4 order-0 mb-6">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between py-3">
                            <div class="card-title mb-0">
                                <h5 class="mb-1 me-2">Foreman</h5>
                            </div>
                            <!-- <div class="dropdown">
                                 <button class="btn text-body-secondary p-0"
                                         type="button"
                                         id="orederStatistics"
                                         data-bs-toggle="dropdown"
                                         aria-haspopup="true"
                                         aria-expanded="false">
                                     <i class="icon-base bx bx-dots-vertical-rounded icon-lg"></i>
                                 </button>
                                 <div class="dropdown-menu dropdown-menu-end" aria-labelledby="orederStatistics">
                                     <a class="dropdown-item" href="javascript:void(0);">Select All</a>
                                     <a class="dropdown-item" href="javascript:void(0);">Refresh</a>
                                     <a class="dropdown-item" href="javascript:void(0);">Share</a>
                                 </div>
                             </div> -->
                            <div class="row">
                                <div class="col">
                                    <a id="foremannew" title="Add New" href="#" class="btn btn-primary btn-sm btn-circle ml-2">
                                        <i class="fas fa-plus"></i>
                                    </a>
                                    <a id="foremansave" title="Save" href="#" class="btn btn-success btn-sm btn-circle ml-4">
                                        <i class="fas fa-save"></i>
                                    </a>

                                </div>
                            </div>
                        </div>
                        <div class="card-body px-3">
                            <div class="card pb-2">
                                <div class="card-body py-2">
                                    <div class="row g-6 pb-1">
                                        <div class="col-3 px-1">
                                            <div>
                                                <label for="ftEmplNo" class="form-label">No</label>
                                                <input class="d-none" id="ForemanID" value="0" />
                                                <input id="ftEmplNo"
                                                       class="form-control form-control-sm vtext vnumber"
                                                       type="text"
                                                       placeholder="" />
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-9 px-1">
                                            <div>
                                                <label for="ftEmplName" class="form-label">Emp Name</label>
                                                <input id="ftEmplName"
                                                       class="form-control form-control-sm vtext"
                                                       type="text"
                                                       placeholder="" />
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive text-nowrap py-4">
                                <table id="ForemanTable" class="table table-striped">
                                    <thead class="table-dark">
                                        <tr>
                                            <th class="d-none">Id</th>
                                            <th scope="col" class="col-1">No</th>
                                            <th>Emp Name</th>
                                            <th scope="col" class="col-1">Act</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table-border-bottom-0">
                                        @if (Model.vForeman.Count > 0)
                                        {
                                            foreach (var item in Model.vForeman)
                                            {
                                                <tr>
                                                    <td class="d-none">
                                                        <span class="rForemanId">@item.Id</span>
                                                    </td>
                                                    <td>
                                                        <span class="ftEmplNo">@item.ftEmplNo</span>
                                                    </td>
                                                    <td>
                                                        <span class="ftEmplName">@item.ftEmplName</span>
                                                    </td>
                                                    <td>
                                                        <div>
                                                            <a class="sDelete" data-code="@item.Id"><i class="icon-base bx bx-trash icon-xm text-danger me-4 me-1"></i></a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Storeman -->
                <div class="col-md-6 col-lg-4 col-xl-4 order-0 mb-6">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between py-3">
                            <div class="card-title mb-0">
                                <h5 class="mb-1 me-2">Storeman</h5>
                            </div>
                            <!-- <div class="dropdown">
                                 <button class="btn text-body-secondary p-0"
                                         type="button"
                                         id="orederStatistics"
                                         data-bs-toggle="dropdown"
                                         aria-haspopup="true"
                                         aria-expanded="false">
                                     <i class="icon-base bx bx-dots-vertical-rounded icon-lg"></i>
                                 </button>
                                 <div class="dropdown-menu dropdown-menu-end" aria-labelledby="orederStatistics">
                                     <a class="dropdown-item" href="javascript:void(0);">Select All</a>
                                     <a class="dropdown-item" href="javascript:void(0);">Refresh</a>
                                     <a class="dropdown-item" href="javascript:void(0);">Share</a>
                                 </div>
                             </div> -->
                            <div class="row">
                                <div class="col">
                                    <a id="storemannew" title="Add New" href="#" class="btn btn-primary btn-sm btn-circle ml-2">
                                        <i class="fas fa-plus"></i>
                                    </a>
                                    <a id="storemansave" title="Save" href="#" class="btn btn-success btn-sm btn-circle ml-4">
                                        <i class="fas fa-save"></i>
                                    </a>

                                </div>
                            </div>
                        </div>
                        <div class="card-body px-3">
                            <div class="card pb-2">
                                <div class="card-body py-2">
                                    <div class="row g-6 pb-1">
                                        <div class="col-3 px-1">
                                            <div>
                                                <label for="stEmplNo" class="form-label">No</label>
                                                <input class="d-none" id="StoremanID" value="0" />
                                                <input id="stEmplNo"
                                                       class="form-control form-control-sm vtext vnumber"
                                                       type="text"
                                                       placeholder="" />
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-9 px-1">
                                            <div>
                                                <label for="stEmplName" class="form-label">Emp Name</label>
                                                <input id="stEmplName"
                                                       class="form-control form-control-sm vtext"
                                                       type="text"
                                                       placeholder="" />
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive text-nowrap py-4">
                                <table id="StoremanTable" class="table table-striped">
                                    <thead class="table-dark">
                                        <tr>
                                            <th class="d-none">Id</th>
                                            <th scope="col" class="col-1">No</th>
                                            <th>Emp Name</th>
                                            <th scope="col" class="col-1">Act</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table-border-bottom-0">
                                        @if (Model.vStoreMan.Count > 0)
                                        {
                                            foreach (var item in Model.vStoreMan)
                                            {
                                                <tr>
                                                    <td class="d-none">
                                                        <span class="rStoremanId">@item.Id</span>
                                                    </td>
                                                    <td>
                                                        <span class="stEmplNo">@item.stEmplNo</span>
                                                    </td>
                                                    <td>
                                                        <span class="stEmplName">@item.stEmplName</span>
                                                    </td>
                                                    <td>
                                                        <div>
                                                            <a class="sDelete" data-code="@item.Id"><i class="icon-base bx bx-trash icon-xm text-danger me-4 me-1"></i></a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Unit -->
                <div class="col-md-6 col-lg-4 col-xl-4 order-0 mb-6">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between py-3">
                            <div class="card-title mb-0">
                                <h5 class="mb-1 me-2">Unit</h5>
                            </div>
                            <!-- <div class="dropdown">
                                 <button class="btn text-body-secondary p-0"
                                         type="button"
                                         id="orederStatistics"
                                         data-bs-toggle="dropdown"
                                         aria-haspopup="true"
                                         aria-expanded="false">
                                     <i class="icon-base bx bx-dots-vertical-rounded icon-lg"></i>
                                 </button>
                                 <div class="dropdown-menu dropdown-menu-end" aria-labelledby="orederStatistics">
                                     <a class="dropdown-item" href="javascript:void(0);">Select All</a>
                                     <a class="dropdown-item" href="javascript:void(0);">Refresh</a>
                                     <a class="dropdown-item" href="javascript:void(0);">Share</a>
                                 </div>
                             </div> -->
                            <div class="row">
                                <div class="col">
                                    <a id="unitnew" title="Add New" href="#" class="btn btn-primary btn-sm btn-circle ml-2">
                                        <i class="fas fa-plus"></i>
                                    </a>
                                    <a id="unitsave" title="Save" href="#" class="btn btn-success btn-sm btn-circle ml-4">
                                        <i class="fas fa-save"></i>
                                    </a>

                                </div>
                            </div>
                        </div>
                        <div class="card-body px-3">
                            <div class="card pb-2">
                                <div class="card-body py-2">
                                    <div class="row g-6 pb-1">
                                        <div class="col-3 px-1">
                                            <div>
                                                <label for="uID" class="form-label">Unit</label>
                                                <input class="d-none" id="UnitID" value="0" />
                                                <input id="uID"
                                                       class="form-control form-control-sm vtext vnumber"
                                                       type="text"
                                                       placeholder="" />
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-9 px-1">
                                            <div>
                                                <label for="uDescription" class="form-label">Description</label>
                                                <input id="uDescription"
                                                       class="form-control form-control-sm vtext"
                                                       type="text"
                                                       placeholder="" />
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive text-nowrap py-4">
                                <table id="UnitTable" class="table table-striped">
                                    <thead class="table-dark">
                                        <tr>
                                            <th class="d-none">Id</th>
                                            <th scope="col" class="col-1">Unit</th>
                                            <th>Description</th>
                                            <th scope="col" class="col-1">Act</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table-border-bottom-0">
                                        @if (Model.vUnit.Count > 0)
                                        {
                                            foreach (var item in Model.vUnit)
                                            {
                                                <tr>
                                                    <td class="d-none">
                                                        <span class="rUnitId">@item.Id</span>
                                                    </td>
                                                    <td>
                                                        <span class="uID">@item.uID</span>
                                                    </td>
                                                    <td>
                                                        <span class="uDescription">@item.uDescription</span>
                                                    </td>
                                                    <td>
                                                        <div>
                                                            <a class="sDelete" data-code="@item.Id"><i class="icon-base bx bx-trash icon-xm text-danger me-4 me-1"></i></a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- / Content -->
        <!-- Footer -->
        <footer class="content-footer footer bg-footer-theme">
            <div class="container-xxl">
                <div class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                    <div class="mb-2 mb-md-0">
                        ©
                        <script>
                            document.write(new Date().getFullYear());
                        </script>
                        made by
                        <a href="https://ptodg.com/id/" target="_blank" class="footer-link">ODG Indonesia</a>
                    </div>

                </div>
            </div>
        </footer>
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
    </div>
    <!-- Content wrapper -->

    <script>
        $(document).ready(function () {
            //FOREMAN
            $('#ForemanTable').DataTable({
                //responsive: true,
                // "columnDefs": [
                //     { "width": "10%", "targets": 0 }
                // ],
                columns: [null, { width: '10%' }, null, { width: '20%' }],
                "aoColumnDefs": [
                    { "bSortable": false, "aTargets": [0, 1, 2, 3] }
                ],
                paging: true,
                // "autoWidth": false,
                // searching: false,
                "lengthChange": false
            });
            $('#ForemanTable').on('click', 'tbody tr td', function () {
                $('#ForemanID').val($(this).closest('tr').find('.rForemanId').html());
                $('#ftEmplNo').val($(this).closest('tr').find('.ftEmplNo').html());
                $('#ftEmplName').val($(this).closest('tr').find('.ftEmplName').html());
                $('#ftEmplNo').prop("disabled", true);
            });
            $('#foremansave').on('click', function (e) {
                e.preventDefault();
                $("#spinner").show();
                $("body").css("pointer-events", "none");
                $(".layout-wrapper").css("opacity", 0.6);
                if (!ValidationCheck($(this).closest('.card'))) {
                    SaveForeman();
                }
                else {
                    $("#spinner").hide();
                    $("body").css("pointer-events", "");
                    $(".layout-wrapper").css("opacity", 1);
                }
            });
            $('#foremannew').on('click', function (e) {
                clearForeman();
            });
            $('#ForemanTable').on('click', '.sDelete', function () {
                var Id = $(this).attr('data-code');
                Swal.fire({
                    title: 'Delete this Item?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    reverseButtons: true
                }).then((result) => {
                    if (result.value) {
                        $(this).closest('tr').remove();
                        DeleteItem('Foreman', Id);
                        clearForeman();
                    } else if (
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        Swal.fire(
                            'Cancelled',
                            '',
                            'error'
                        )
                    }
                })
            });
            function clearForeman() {
                $('#ForemanID').val(0);
                $('#ftEmplNo').val('');
                $('#ftEmplName').val('');
                $('#ftEmplNo').prop("disabled", false);
                clearValidMain();
                $('#ftEmplNo').focus();
            }
            function getForeman() {
                var tmp_Id = $('#ForemanID').val() == '' ? 0 : $('#ForemanID').val();
                var tmp_ftEmplNo = $('#ftEmplNo').val();
                var tmp_ftEmplName = $('#ftEmplName').val();
                return (tmp_Id == "") ? null :
                    {
                        Id: tmp_Id,
                        ftEmplNo: tmp_ftEmplNo,
                        ftEmplName: tmp_ftEmplName
                    };
            }
            function SaveForeman() {
                $.ajax({
                    url: '/Master/SaveForeman',
                    type: "POST",
                    data: JSON.stringify(getForeman()),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    traditional: true,
                    success: function (data) {
                        if (data) {
                            if (data.value.success) {
                                addForeman()
                                if (data.value.typ_ == 'Create') {
                                    $("#ForemanTable>tbody>tr:first").find('.rForemanId').text(data.value.result);
                                }
                                clearForeman();
                            }
                            else {
                                Swal.fire({
                                    title: 'Duplicate!!!',
                                    text: 'Foreman no : ' + data.value.typ_ + ' already exist!',
                                    icon: 'error'
                                })
                            }

                        }
                        else {
                            alert(data.text);
                        }
                        $("#spinner").hide();
                        $("body").css("pointer-events", "");
                        $(".layout-wrapper").css("opacity", 1);
                    },
                    error: function (data) {
                        alert(data.text);
                        $("#spinner").hide();
                        $("body").css("pointer-events", "");
                        $(".layout-wrapper").css("opacity", 1);
                    }
                });
            }
            function addForeman() {
                if ($('#ForemanID').val() != '0') {
                    var elems = $('.rForemanId').filter(function () {
                        return this.textContent.trim() === $('#ForemanID').val()
                    });
                    elems.closest('tr').find('.ftEmplNo').text($('#ftEmplNo').val());
                    elems.closest('tr').find('.ftEmplName').text($('#ftEmplName').val());
                    blink(elems.closest('tr'));
                }
                else {
                    var newRow = $("<tr>");
                    var cols = '';

                    cols += '<td class="d-none"> <span class="rForemanId">' + $('#ForemanID').val() + '</span> </td>';
                    cols += '<td class="dt-type-numeric"> <span class="ftEmplNo">' + $('#ftEmplNo').val() + '</span> </td>';
                    cols += '<td> <span class="ftEmplName">' + $('#ftEmplName').val() + '</span> </td>';
                    cols += '<td> <div> <a class="sDelete" data-code="' + $('#ForemanID').val() + '"><i class="icon-base bx bx-trash icon-xm text-danger me-4 me-1"></i></a> </div> </td>';


                    newRow.append(cols);

                    $("#ForemanTable >tbody").prepend(newRow);
                    // $("#serviceTable").DataTable()
                    //     .columns.adjust()
                    //     .responsive.recalc();
                    blink(newRow);
                }
            }
            //END
            //STOREMAN
            $('#StoremanTable').DataTable({
                //responsive: true,
                // "columnDefs": [
                //     { "width": "10%", "targets": 0 }
                // ],
                columns: [null, { width: '10%' }, null, { width: '20%' }],
                "aoColumnDefs": [
                    { "bSortable": false, "aTargets": [0, 1, 2, 3] }
                ],
                paging: true,
                // "autoWidth": false,
                // searching: false,
                "lengthChange": false
            });
            $('#StoremanTable').on('click', 'tbody tr td', function () {
                $('#StoremanID').val($(this).closest('tr').find('.rStoremanId').html());
                $('#stEmplNo').val($(this).closest('tr').find('.stEmplNo').html());
                $('#stEmplName').val($(this).closest('tr').find('.stEmplName').html());
                $('#stEmplNo').prop("disabled", true);
            });
            $('#storemansave').on('click', function (e) {
                e.preventDefault();
                $("#spinner").show();
                $("body").css("pointer-events", "none");
                $(".layout-wrapper").css("opacity", 0.6);
                if (!ValidationCheck($(this).closest('.card'))) {
                    SaveStoreman();
                }
                else {
                    $("#spinner").hide();
                    $("body").css("pointer-events", "");
                    $(".layout-wrapper").css("opacity", 1);
                }
            });
            $('#storemannew').on('click', function (e) {
                clearStoreman();
            });
            $('#StoremanTable').on('click', '.sDelete', function () {
                var Id = $(this).attr('data-code');
                Swal.fire({
                    title: 'Delete this Item?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    reverseButtons: true
                }).then((result) => {
                    if (result.value) {
                        $(this).closest('tr').remove();
                        DeleteItem('Storeman', Id);
                        clearStoreman();
                    } else if (
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        Swal.fire(
                            'Cancelled',
                            '',
                            'error'
                        )
                    }
                })
            });
            function clearStoreman() {
                $('#StoremanID').val(0);
                $('#stEmplNo').val('');
                $('#stEmplName').val('');
                $('#stEmplNo').prop("disabled", false);
                clearValidMain();
                $('#stEmplNo').focus();
            }
            function getStoreman() {
                var tmp_Id = $('#StoremanID').val() == '' ? 0 : $('#StoremanID').val();
                var tmp_stEmplNo = $('#stEmplNo').val();
                var tmp_stEmplName = $('#stEmplName').val();
                return (tmp_Id == "") ? null :
                    {
                        Id: tmp_Id,
                        stEmplNo: tmp_stEmplNo,
                        stEmplName: tmp_stEmplName
                    };
            }
            function SaveStoreman() {
                $.ajax({
                    url: '/Master/SaveStoreman',
                    type: "POST",
                    data: JSON.stringify(getStoreman()),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    traditional: true,
                    success: function (data) {
                        if (data) {
                            if (data.value.success) {
                                addStoreman()
                                if (data.value.typ_ == 'Create') {
                                    $("#StoremanTable>tbody>tr:first").find('.rStoremanId').text(data.value.result);
                                }
                                clearStoreman();
                            }
                            else {
                                Swal.fire({
                                    title: 'Duplicate!!!',
                                    text: 'Storeman no : ' + data.value.typ_ + ' already exist!',
                                    icon: 'error'
                                })
                            }

                        }
                        else {
                            alert(data.text);
                        }
                        $("#spinner").hide();
                        $("body").css("pointer-events", "");
                        $(".layout-wrapper").css("opacity", 1);
                    },
                    error: function (data) {
                        alert(data.text);
                        $("#spinner").hide();
                        $("body").css("pointer-events", "");
                        $(".layout-wrapper").css("opacity", 1);
                    }
                });
            }
            function addStoreman() {
                if ($('#StoremanID').val() != '0') {
                    var elems = $('.rStoremanId').filter(function () {
                        return this.textContent.trim() === $('#StoremanID').val()
                    });
                    elems.closest('tr').find('.stEmplNo').text($('#stEmplNo').val());
                    elems.closest('tr').find('.stEmplName').text($('#stEmplName').val());
                    blink(elems.closest('tr'));
                }
                else {
                    var newRow = $("<tr>");
                    var cols = '';

                    cols += '<td class="d-none"> <span class="rStoremanId">' + $('#StoremanID').val() + '</span> </td>';
                    cols += '<td class="dt-type-numeric"> <span class="stEmplNo">' + $('#stEmplNo').val() + '</span> </td>';
                    cols += '<td> <span class="stEmplName">' + $('#stEmplName').val() + '</span> </td>';
                    cols += '<td> <div> <a class="sDelete" data-code="' + $('#StoremanID').val() + '"><i class="icon-base bx bx-trash icon-xm text-danger me-4 me-1"></i></a> </div> </td>';


                    newRow.append(cols);

                    $("#StoremanTable >tbody").prepend(newRow);
                    // $("#serviceTable").DataTable()
                    //     .columns.adjust()
                    //     .responsive.recalc();
                    blink(newRow);
                }
            }
            //END
            //UNIT
            $('#UnitTable').DataTable({
                //responsive: true,
                // "columnDefs": [
                //     { "width": "10%", "targets": 0 }
                // ],
                columns: [null, { width: '10%' }, null, { width: '20%' }],
                "aoColumnDefs": [
                    { "bSortable": false, "aTargets": [0, 1, 2, 3] }
                ],
                paging: true,
                // "autoWidth": false,
                // searching: false,
                "lengthChange": false
            });
            $('#UnitTable').on('click', 'tbody tr td', function () {
                $('#UnitID').val($(this).closest('tr').find('.rUnitId').html());
                $('#uID').val($(this).closest('tr').find('.uID').html());
                $('#uDescription').val($(this).closest('tr').find('.uDescription').html());
                $('#uID').prop("disabled", true);
            });
            $('#unitsave').on('click', function (e) {
                e.preventDefault();
                $("#spinner").show();
                $("body").css("pointer-events", "none");
                $(".layout-wrapper").css("opacity", 0.6);
                if (!ValidationCheck($(this).closest('.card'))) {
                    SaveUnit();
                }
                else {
                    $("#spinner").hide();
                    $("body").css("pointer-events", "");
                    $(".layout-wrapper").css("opacity", 1);
                }
            });
            $('#unitnew').on('click', function (e) {
                clearUnit();
            });
            $('#UnitTable').on('click', '.sDelete', function () {
                var Id = $(this).attr('data-code');
                Swal.fire({
                    title: 'Delete this Item?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    reverseButtons: true
                }).then((result) => {
                    if (result.value) {
                        $(this).closest('tr').remove();
                        DeleteItem('Unit', Id);
                        clearUnit();
                    } else if (
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        Swal.fire(
                            'Cancelled',
                            '',
                            'error'
                        )
                    }
                })
            });
            function clearUnit() {
                $('#UnitID').val(0);
                $('#uID').val('');
                $('#uDescription').val('');
                $('#uID').prop("disabled", false);
                clearValidMain();
                $('#uID').focus();
            }
            function getUnit() {
                var tmp_Id = $('#UnitID').val() == '' ? 0 : $('#UnitID').val();
                var tmp_uID = $('#uID').val();
                var tmp_uDescription = $('#uDescription').val();
                return (tmp_Id == "") ? null :
                    {
                        Id: tmp_Id,
                        uID: tmp_uID,
                        uDescription: tmp_uDescription
                    };
            }
            function SaveUnit() {
                $.ajax({
                    url: '/Master/SaveUnit',
                    type: "POST",
                    data: JSON.stringify(getUnit()),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    traditional: true,
                    success: function (data) {
                        if (data) {
                            if (data.value.success) {
                                addUnit()
                                if (data.value.typ_ == 'Create') {
                                    $("#UnitTable>tbody>tr:first").find('.rUnitId').text(data.value.result);
                                }
                                clearUnit();
                            }
                            else {
                                Swal.fire({
                                    title: 'Duplicate!!!',
                                    text: 'Unit no : ' + data.value.typ_ + ' already exist!',
                                    icon: 'error'
                                })
                            }

                        }
                        else {
                            alert(data.text);
                        }
                        $("#spinner").hide();
                        $("body").css("pointer-events", "");
                        $(".layout-wrapper").css("opacity", 1);
                    },
                    error: function (data) {
                        alert(data.text);
                        $("#spinner").hide();
                        $("body").css("pointer-events", "");
                        $(".layout-wrapper").css("opacity", 1);
                    }
                });
            }
            function addUnit() {
                if ($('#UnitID').val() != '0') {
                    var elems = $('.rUnitId').filter(function () {
                        return this.textContent.trim() === $('#UnitID').val()
                    });
                    elems.closest('tr').find('.uID').text($('#uID').val());
                    elems.closest('tr').find('.uDescription').text($('#uDescription').val());
                    blink(elems.closest('tr'));
                }
                else {
                    var newRow = $("<tr>");
                    var cols = '';

                    cols += '<td class="d-none"> <span class="rUnitId">' + $('#UnitID').val() + '</span> </td>';
                    cols += '<td class="dt-type-numeric"> <span class="uID">' + $('#uID').val() + '</span> </td>';
                    cols += '<td> <span class="uDescription">' + $('#uDescription').val() + '</span> </td>';
                    cols += '<td> <div> <a class="sDelete" data-code="' + $('#UnitID').val() + '"><i class="icon-base bx bx-trash icon-xm text-danger me-4 me-1"></i></a> </div> </td>';


                    newRow.append(cols);

                    $("#UnitTable >tbody").prepend(newRow);
                    // $("#serviceTable").DataTable()
                    //     .columns.adjust()
                    //     .responsive.recalc();
                    blink(newRow);
                }
            }
            //END
            function DeleteItem(typ, id) {
                var itms = {};
                itms.Id = id;
                itms.Typ = typ
                $.ajax({
                    url: '/Master/DeleteItem',
                    type: "POST",
                    data: JSON.stringify(itms),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    traditional: true,
                    success: function (data) {
                        if (data) {
                            Swal.fire({
                                title: typ + ' Data!!!',
                                text: typ + ' data has been deleted!',
                                icon: 'success'
                            })
                        }
                        else {
                            alert(data.text);
                        }
                    },
                    error: function (data) {
                        alert(data.text);
                    }
                });
            }
            function ValidationCheck(com) {
                com.find(".vtext").each(function () {
                    if (!$(this).hasClass('is-valid') || !$(this).hasClass('is-invalid')) {
                        if ($(this).hasClass('form-select')) {
                            (($(this).find('option:selected').attr('data-code') == "0") ? $(this).addClass('is-invalid') : $(this).addClass('is-valid'));
                        }
                        else {
                            (($(this).val() == '') ? $(this).addClass('is-invalid') : $(this).addClass('is-valid'));
                        }
                    }
                });
                com.find(".select2-selection.select2-selection--single").each(function () {
                    if (!$(this).hasClass('is-valid') || !$(this).hasClass('is-invalid')) {
                        if (!$(this).find('.select2-selection__rendered').attr("title")) {
                            $(this).find('.select2-selection__rendered').children().length > 0 ? $(this).addClass('is-invalid') : $(this).addClass('is-valid')
                        }
                    }
                });
                return com.find('.vtext').hasClass('is-invalid') || com.find(".select2-selection.select2-selection--single").hasClass('is-invalid') ? true : false;

            }
            function clearValidMain() {
                $(".is-valid").each(function () {
                    $(this).removeClass('is-valid');
                });
                $(".is-invalid").each(function () {
                    $(this).removeClass('is-invalid');
                });
                $(".select2-selection.select2-selection--single").each(function () {
                    $(this).find('.select2-selection__rendered').removeAttr('title');
                });
            }
        })
    </script>
}
